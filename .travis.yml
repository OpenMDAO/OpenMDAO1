branches:
  only:
  - master
  - /^test.*$/
sudo: false
os:
- linux
- osx
language: generic
env:
- HDF5=h5py PY=2.7 MPI=1
- HDF5=h5py PY=2.7 MPI=
- HDF5=h5py PY=3.4 MPI=
- HDF5= PY=2.7 MPI=
- HDF5= PY=3.4 MPI=
matrix:
  exclude:
  - os: osx
    env: HDF5=h5py PY=2.7 MPI=1
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gfortran
    - libblas-dev
    - liblapack-dev
    - libopenmpi-dev
    - openmpi-bin
notifications:
  email: false
  slack:
    secure: Rsx3X0doYh1rI3CnCngLQ9NRTRbAxaep23kTXUks8TRjKxkOoYPSNWBXGT5qRmldA4JsyI006mhxY9Yu2Kj+lJNwL2I/orsLCJAEfC+AgfpIOFiW/eWjdKxIuibBn2puScSiIVIipJdWPVVKarWFrMvM2N+OXNRtOrs8dL436TWd8X6IXSqjtUiENIawHjQa+5TdI0gEDf9AxjXuXH51SoCzyGtk8cLYVbD0QfLR/ZlnSg+fw6UyE1Yjb3pdYa5ONKk/TylVS9r+Kltq+pnWc3YoF37+LneTgfDpiZGyNbULYNHXNWcCtXJM1Tkrltpj39160zvY1AYgA1ElDj04v5hmA3O8R9KVQi1mF9shFNr0B8EXKzQ5yTbvSg48egSI+YC0RpeVP2LLB2jmYt8BEAjVDSeHDHg66/nD6d3UgBzli8NNZCl0xE43M31Plu0Dy8CQPouCqlZMQYLVHgQqUtqjsST250YE29r6mgy/npjm8a5jqJVjhEpfGRhF7DSjxdWsHLuod6d3tyXnpEBX/5dFa6lCpfMQ953kKzbOjv8Xok3hAqCvfmTUyILVFQ1tAZ0KZ/KhgEu1igwixofYzdxKpxz1ILnooq4evU6i4r/DlPhM5870rwfXM2LtabMLwBtGZqRE1k7wwsaIx7X1DaKv6lKHIfjaasWL2agxIkk=
before_install:
- OS=$(if [[ "$TRAVIS_OS_NAME" = "osx" ]]; then echo "MacOSX"; else echo "Linux";
  fi)
- if [ "$OS" = "MacOSX" ] && [ "$MPI" ]; then brew install openmpi; fi
- if [ "$PY" = "2.7" ];  then wget "https://repo.continuum.io/miniconda/Miniconda2-latest-$OS-x86_64.sh"
  -O miniconda.sh; fi
- if [ "$PY" = "3.4" ];  then wget "https://repo.continuum.io/miniconda/Miniconda3-latest-$OS-x86_64.sh"
  -O miniconda.sh; fi
- chmod +x miniconda.sh
- if [ "$OS" = "Linux" ]; then ./miniconda.sh -b  -p /home/travis/miniconda; fi
- if [ "$OS" = "MacOSX" ]; then ./miniconda.sh -b  -p /Users/travis/miniconda; fi
- PATHPREFIX=$(if [[ "$TRAVIS_OS_NAME" = "osx" ]]; then echo "/Users/travis/miniconda/bin";
  else echo "/home/travis/miniconda/bin"; fi)
- export PATH=$PATHPREFIX:$PATH
- export OPENMDAO_TEST_DOCS=1
install:
- conda install --yes python=$PY numpy scipy nose $HDF5 sphinx==1.3.1 mock swig
- if [ "$OS" = "Linux" ]; then if [ "$PY" = "2.7" ]; then pip install https://openmdao.org/dists/pyoptsparse-1.0.0-cp27-none-linux_x86_64.whl;
  elif [ "$PY" = "3.4" ]; then pip install https://openmdao.org/dists/pyoptsparse-1.0.0-py3-none-linux_x86_64.whl;
  fi fi
- if [ "$OS" = "MacOSX" ]; then if [ "$PY" = "2.7" ]; then pip install https://openmdao.org/dists/pyoptsparse-1.0.0-py2-none-macosx_10_5_x86_64.whl;
  elif [ "$PY" = "3.4" ]; then pip install https://openmdao.org/dists/pyoptsparse-1.0.0-cp34-none-macosx_10_5_x86_64.whl;
  fi fi
- if [ "$MPI" ]; then pip install mpi4py; pip install --no-deps git+https://bitbucket.org/petsc/petsc@v3.5;
  conda install cython --yes; pip install --no-deps git+https://bitbucket.org/petsc/petsc4py@3.5;
  fi
- pip install git+https://github.com/OpenMDAO/testflo.git
- pip install coveralls
- pip install -e .
script:
- testflo . -n 1 --coverage --coverpkg openmdao
after_success: coveralls
